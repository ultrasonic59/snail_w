###############################################################################
#
# IAR ANSI C/C++ Compiler V8.40.1.212/W32 for ARM         08/May/2021  18:23:18
# Copyright 1999-2019 IAR Systems AB.
#
#    Cpu mode     =  
#    Endian       =  little
#    Source file  =  D:\proj\velograph\snail\stm32_snail\mstep_usb\src\main.c
#    Command line =
#        -f C:\Users\vova\AppData\Local\Temp\EWC308.tmp
#        (D:\proj\velograph\snail\stm32_snail\mstep_usb\src\main.c -D
#        VECT_TAB_FLASH -D IAR_ARM_CM3 -D USEUSB -D MSTEP_BRD -D USE_USB_OTG_FS
#        -lcN D:\proj\velograph\snail\stm32_snail\mstep_usb\usb_can\List
#        --diag_suppress Pa082,pe191 -o
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\usb_can\Obj --no_cse
#        --no_unroll --no_inline --no_code_motion --no_tbaa --no_clustering
#        --no_scheduling --debug --endian=little --cpu=Cortex-M3 -e --fpu=None
#        --dlib_config "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.3\arm\inc\c\DLib_Config_Full.h" -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\.\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\src\board\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\freertos\source\inc\
#        -I D:\proj\velograph\snail\stm32_snail\mstep_usb\src\inc\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\freertos\source\port\ARM_CM3\
#        -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\libraries\inc\
#        -I D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\libraries\
#        -I D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\dbg\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\libraries\STM32F2xx_StdPeriph_Driver\inc\
#        -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\libraries\STM32F2xx_StdPeriph_Driver\
#        -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\usb\core\inc\
#        -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\usb\drv\inc\
#        -I D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\usb\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\usb\inc\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\hdlc\ -I
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\..\common\usb\cdc\ -On
#        --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 8.3\arm\CMSIS\Core\Include\" -I "C:\Program Files (x86)\IAR
#        Systems\Embedded Workbench 8.3\arm\CMSIS\DSP\Include\")
#    Locale       =  C
#    List file    =
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\usb_can\List\main.lst
#    Object file  =
#        D:\proj\velograph\snail\stm32_snail\mstep_usb\usb_can\Obj\main.o
#
###############################################################################

D:\proj\velograph\snail\stm32_snail\mstep_usb\src\main.c
      1          /*
      2           * FreeRTOS Kernel V10.2.1
      3           * Copyright (C) 2019 Amazon.com, Inc. or its affiliates.  All Rights Reserved.
      4           *
      5           * Permission is hereby granted, free of charge, to any person obtaining a copy of
      6           * this software and associated documentation files (the "Software"), to deal in
      7           * the Software without restriction, including without limitation the rights to
      8           * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
      9           * the Software, and to permit persons to whom the Software is furnished to do so,
     10           * subject to the following conditions:
     11           *
     12           * The above copyright notice and this permission notice shall be included in all
     13           * copies or substantial portions of the Software.
     14           *
     15           * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     16           * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
     17           * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
     18           * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
     19           * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
     20           * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
     21           *
     22           * http://www.FreeRTOS.org
     23           * http://aws.amazon.com/freertos
     24           *
     25           * 1 tab == 4 spaces!
     26           */
     27          
     28          /*
     29           * Creates all the demo application tasks, then starts the scheduler.  The WEB
     30           * documentation provides more details of the standard demo application tasks.
     31           * In addition to the standard demo tasks, the following tasks and tests are
     32           * defined and/or created within this file:
     33           *
     34           * "Fast Interrupt Test" - A high frequency periodic interrupt is generated
     35           * using a free running timer to demonstrate the use of the
     36           * configKERNEL_INTERRUPT_PRIORITY configuration constant.  The interrupt
     37           * service routine measures the number of processor clocks that occur between
     38           * each interrupt - and in so doing measures the jitter in the interrupt timing.
     39           * The maximum measured jitter time is latched in the ulMaxJitter variable, and
     40           * displayed on the LCD by the 'Check' task as described below.  The
     41           * fast interrupt is configured and handled in the timertest.c source file.
     42           *
     43           * "LCD" task - the LCD task is a 'gatekeeper' task.  It is the only task that
     44           * is permitted to access the display directly.  Other tasks wishing to write a
     45           * message to the LCD send the message on a queue to the LCD task instead of
     46           * accessing the LCD themselves.  The LCD task just blocks on the queue waiting
     47           * for messages - waking and displaying the messages as they arrive.
     48           *
     49           * "Check" task -  This only executes every five seconds but has the highest
     50           * priority so is guaranteed to get processor time.  Its main function is to
     51           * check that all the standard demo tasks are still operational.  Should any
     52           * unexpected behaviour within a demo task be discovered the 'check' task will
     53           * write an error to the LCD (via the LCD task).  If all the demo tasks are
     54           * executing with their expected behaviour then the check task writes PASS
     55           * along with the max jitter time to the LCD (again via the LCD task), as
     56           * described above.
     57           *
     58           */
     59          
     60          /* Standard includes. */
     61          #include <stdio.h>
     62          
     63          /* Scheduler includes. */
     64          #include "FreeRTOS.h"
     65          #include "task.h"
     66          #include "queue.h"
     67          
     68          /* Library includes. */
     69          ////#include "stm32f2xx_it.h"
     70          #include "stm32f2xx_rcc.h"
     71          
     72          /* Demo app includes. */
     73          #include "board.h"
     74          #include "usbd_core.h"
     75          #include "usbd_desc.h"
     76          
     77          #include "can.h"
     78          
     79          #include "misc.h"
     80          #include "printk.h"
     81          ///=======================================================================
     82          extern void usb_thread( void *arg );
     83          extern void init_hdlc_vcp(void);
     84          
     85          #define TST_TASK_STACK_SIZE			( configMINIMAL_STACK_SIZE + 50 )
     86          #define TST_TASK_PRIORITY				( tskIDLE_PRIORITY + 3 )
     87          void tst_task( void *pvParameters );
     88          ///==================================
     89          TaskHandle_t  usb_thread_handle;
     90          ///==================================
     91          
     92          ///=======================================================================
     93          ///==================================
     94          #pragma data_alignment=8   
     95          __ALIGN_BEGIN USB_OTG_CORE_HANDLE    USB_OTG_dev __ALIGN_END ;
     96          
     97          extern USBD_Class_cb_TypeDef  USBD_CDC_VCP_cb;
     98          #define USBD_Class_cb USBD_CDC_VCP_cb
     99          extern USBD_Class_cb_TypeDef  USBD_CDC_cb;
    100          ////#define USBD_Class_cb USBD_CDC_cb
    101          
    102          extern USBD_Usr_cb_TypeDef USR_cb;
    103          
    104          ////========================================================
    105          void uDelay (const uint32_t usec)
    106          {
    107          uint32_t count = 0;
    108          const uint32_t utime = 45*usec;////(120 * usec / 7);
    109          do
    110            {
    111             if ( ++count > utime )
    112              {
    113              return ;
    114              }
    115            }
    116          while (1);
    117          }
    118             
    119          ////============================================
    120          int main( void )
    121          {
    122          ////uint8_t btst=0; 
    123          ////uint32_t tst=0;
    124          #ifdef DEBUG
    125            debug();
    126          #endif
    127          __disable_irq();
    128          hw_board_init();
    129          
    130          printk("\n\r CAN1_Init"); 
    131          CAN1_Init();
    132          ///=================================  
    133            USBD_Init(&USB_OTG_dev,
    134                      USB_OTG_FS_CORE_ID,
    135                      &USR_desc, 
    136                      &USBD_Class_cb, 
    137                      &USR_cb);
    138          ///=================================  
    139          init_hdlc_vcp();
    140          
    141          
    142          NVIC_PriorityGroupConfig( NVIC_PriorityGroup_4 );
    143                  
    144          ////    xTaskCreate( gbrl_thr, "gbrl", mainCHECK_TASK_STACK_SIZE, NULL, mainCHECK_TASK_PRIORITY, NULL );
    145                   
    146          	/* Start the tasks defined within this file/specific to this demo. */
    147           ////???   xTaskCreate( vCheckTask, "Check", mainCHECK_TASK_STACK_SIZE, NULL, mainCHECK_TASK_PRIORITY, NULL );
    148          ////???	xTaskCreate( vLCDTask, "LCD", configMINIMAL_STACK_SIZE, NULL, tskIDLE_PRIORITY, NULL );
    149          
    150          	/* The suicide tasks must be created last as they need to know how many
    151          	tasks were running prior to their creation in order to ascertain whether
    152          	or not the correct/expected number of tasks are running at any given time. */
    153           ////????   vCreateSuicidalTasks( mainCREATOR_TASK_PRIORITY );
    154          
    155          	/* Configure the timers used by the fast interrupt timer test. */
    156          /////	vSetupTimerTest();
    157            xTaskCreate( tst_task, "tst_task", TST_TASK_STACK_SIZE, NULL, TST_TASK_PRIORITY, NULL );
    158          ////    xTaskCreate( usb_thread, "usb_thread", APPLICATION_STACK_SIZE/sizeof( portSTACK_TYPE ), NULL, APP_PRIORITY, &usb_thread_handle);
    159          
    160          	/* Start the scheduler. */
    161          	vTaskStartScheduler();
    162          
    163          	/* Will only get here if there was not enough heap space to create the
    164          	idle task. */
    165          return 0;
    166          }
    167          ////============================================================
    168          ////=======================================================
    169          
    170          ////=======================================================

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      16   main
        16   -> CAN1_Init
        16   -> NVIC_PriorityGroupConfig
        16   -> USBD_Init
        16   -> hw_board_init
        16   -> init_hdlc_vcp
        16   -> printf
        16   -> vTaskStartScheduler
        16   -> xTaskCreate
       0   uDelay


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable1
       4  ??DataTable1_1
       4  ??DataTable1_2
       4  ??DataTable1_3
       4  ??DataTable1_4
       4  ??DataTable1_5
       4  ??DataTable1_6
      16  ?_0
      12  ?_1
    1524  USB_OTG_dev
      74  main
      18  uDelay
       4  usb_thread_handle

 
 1'528 bytes in section .bss
    28 bytes in section .rodata
   120 bytes in section .text
 
   120 bytes of CODE  memory
    28 bytes of CONST memory
 1'528 bytes of DATA  memory

Errors: none
Warnings: none
